<Page x:Class="TMS.Pages.Customer.SearchTicketsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:dto="clr-namespace:TMS.DTO"
      Title="Search Tickets"
      Background="#F5F7FF">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Back + Header -->
            <RowDefinition Height="Auto"/>
            <!-- Search Panel -->
            <RowDefinition Height="*"/>
            <!-- Schedule Cards -->
        </Grid.RowDefinitions>

        <!-- ================= BACK + HEADER ================= -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <!-- Back Button -->
            <Button Click="Back_Click"
                    Height="40"
                    Width="120"
                    Background="Transparent"
                    BorderThickness="0"
                    Foreground="#1E3A8A"
                    HorizontalAlignment="Left"
                    Padding="10,0,0,0"
                    Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="ArrowLeft" Width="20" Height="20" Margin="0,0,10,0"/>
                    <TextBlock Text="Back" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <!-- Page Header -->
            <TextBlock Text="Book Your Bus Tickets" FontSize="28" FontWeight="Bold" Foreground="#1E3A8A"/>
            <TextBlock Text="Find and select schedules easily" FontSize="16" Foreground="Gray"/>
        </StackPanel>

        <!-- ================= SEARCH PANEL ================= -->
        <Border Grid.Row="1" Background="Transparent" CornerRadius="12" Padding="20" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" >

                <!-- Origin -->
                <StackPanel Margin="0,0,10,0">
                    <TextBlock Text="Origin" FontWeight="SemiBold"/>
                    <ComboBox x:Name="cmbOrigin" Width="180" Height="35" 
                              materialDesign:HintAssist.Hint="Select Origin" 
                              IsEditable="True"/>
                </StackPanel>

                <!-- Destination -->
                <StackPanel Margin="0,0,10,0">
                    <TextBlock Text="Destination" FontWeight="SemiBold"/>
                    <ComboBox x:Name="cmbDestination" Width="180" Height="35" 
                              materialDesign:HintAssist.Hint="Select Destination" 
                              IsEditable="True"/>
                </StackPanel>

                <!-- Date -->
                <StackPanel Margin="0,0,10,0">
                    <TextBlock Text="Date (optional)" FontWeight="SemiBold"/>
                    <DatePicker x:Name="dpDate" Width="150" Height="35" materialDesign:HintAssist.Hint="Select Date"/>
                </StackPanel>

                <!-- Bus Type -->
                <StackPanel Margin="0,0,10,0">
                    <TextBlock Text="Bus Type (optional)" FontWeight="SemiBold"/>
                    <ComboBox x:Name="cmbBusType" Width="150" Height="35" 
                              materialDesign:HintAssist.Hint="Bus Type" 
                              IsEditable="True"/>
                </StackPanel>

                <!-- Search Button -->
                <Button Content="Search"
                        Width="150" Height="35"
                        Background="#1E3A8A"
                        Foreground="White"
                        FontWeight="Bold"
                        VerticalAlignment="Bottom"
                        Click="ViewSchedules_Click"/>
            </StackPanel>
        </Border>

        <!-- ================= SCHEDULE CARDS ================= -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="ScheduleCardsPanel" Margin="0,0,0,20">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel IsItemsHost="True" Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type dto:ScheduleDTO}">
                        <Border Background="White" CornerRadius="12" BorderBrush="#E0E0E0" BorderThickness="1"
                                Padding="15" Margin="10">
                            <Border.Effect>
                                <DropShadowEffect Color="Gray" ShadowDepth="3" Opacity="0.3"/>
                            </Border.Effect>

                            <StackPanel>
                                <!-- Route -->
                                <TextBlock Text="{Binding RouteDisplay}" FontWeight="Bold" FontSize="16" Foreground="#1E3A8A"/>

                                <!-- Departure & Arrival -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="Departure: " FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding DepartureTime, StringFormat=dd MMM yyyy HH:mm}" Foreground="Gray"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="Arrival: " FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding ArrivalTime, StringFormat=dd MMM yyyy HH:mm}" Foreground="Gray"/>
                                </StackPanel>

                                <!-- Duration & Distance -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="Distance: " FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding DistanceKm, StringFormat={}{0} km}" Foreground="Gray"/>
                                    <TextBlock Text="  |  " Foreground="Gray"/>
                                    <TextBlock Text="Duration: " FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Duration}" Foreground="Gray"/>
                                </StackPanel>

                                <!-- Bus info -->
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                    <TextBlock Text="{Binding BusNumber}" FontWeight="SemiBold"/>
                                    <TextBlock Text=" | " Foreground="Gray"/>
                                    <TextBlock Text="{Binding BusType}" Foreground="Gray"/>
                                </StackPanel>

                                <!-- Price + Button -->
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding Price, StringFormat=Rs. {0:N0}}" FontWeight="SemiBold" FontSize="14" Foreground="#0F2A6F" VerticalAlignment="Center"/>
                                    <Button Content="Select Seats"
                                            Width="100" Height="30"
                                            Background="#1E3A8A"
                                            Foreground="White"
                                            FontWeight="Bold"
                                            Grid.Column="1"
                                            Click="SelectSeats_Click"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

    </Grid>
</Page>
